<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Last War - Shooter Game</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(180deg, #0a0a1a 0%, #1a1a2e 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }
        #game-container {
            border: 6px solid #ff0000;
            border-radius: 10px;
            box-shadow: 0 0 40px rgba(255, 0, 0, 0.5);
        }
        #ui-overlay {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 20px;
            font-weight: bold;
            z-index: 1000;
            border: 2px solid #ffd700;
        }
        .stat { display: inline-block; margin: 0 10px; }
        .army-stat { color: #00ff00; }
        .wave-stat { color: #ffff00; }
        .score-stat { color: #ff00ff; }
        .game-over {
            background: rgba(255, 0, 0, 0.9) !important;
            border-color: #ffff00 !important;
        }
    </style>
</head>
<body>
    <div id="ui-overlay">
        <span class="stat army-stat">Army: <span id="armyCount">1</span></span> | 
        <span class="stat wave-stat">Wave: <span id="waveCount">1</span></span> | 
        <span class="stat score-stat">Score: <span id="scoreCount">0</span></span>
    </div>
    
    <div id="game-container"></div>
    
    <script>
        console.log("Last War - Game Starting...");
        
        // Game state
        let scene;
        let player;
        let playerArmy = 1;
        let score = 0;
        let wave = 1;
        let gameState = 'playing';
        
        let enemies = [];
        let bullets = [];
        let bonuses = [];
        let stars = [];
        
        let shootTimer = 0;
        let spawnTimer = 0;
        
        // Config
        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: 'game-container',
            backgroundColor: '#0a0a1a',
            scene: {
                create: create,
                update: update
            }
        };
        
        const game = new Phaser.Game(config);
        
        function create() {
            scene = this;
            console.log("Game Scene Created");
            
            // Background
            scene.add.rectangle(400, 300, 800, 600, 0x0a0a1a);
            
            // Barriers
            scene.add.rectangle(400, 200, 6, 350, 0xff0000);
            scene.add.rectangle(400, 500, 6, 150, 0xff0000);
            
            // Passage
            scene.add.rectangle(400, 445, 8, 54, 0x00ff00, 0.4);
            scene.add.text(360, 435, 'RIGHT', { fontSize: '20px', fill: '#ffff00', fontStyle: 'bold' });
            scene.add.text(420, 435, 'LEFT', { fontSize: '20px', fill: '#ffff00', fontStyle: 'bold' });
            
            // Labels
            scene.add.text(275, 30, 'ENEMIES', {
                fontSize: '20px', fill: '#ff0000', fontStyle: 'bold',
                stroke: '#000000', strokeThickness: 4
            }).setOrigin(0.5);
            
            scene.add.text(525, 30, 'BONUS', {
                fontSize: '20px', fill: '#00ff00', fontStyle: 'bold',
                stroke: '#000000', strokeThickness: 4
            }).setOrigin(0.5);
            
            // Borders
            scene.add.rectangle(150, 300, 6, 600, 0x00ffff, 0.7);
            scene.add.rectangle(650, 300, 6, 600, 0x00ffff, 0.7);
            
            // Stars
            for (let i = 0; i < 30; i++) {
                stars.push({
                    graphics: scene.add.circle(
                        Phaser.Math.Between(0, 800),
                        Phaser.Math.Between(0, 600),
                        2, 0xffffff, 0.8
                    ),
                    speed: Phaser.Math.Between(30, 100)
                });
            }
            
            // Player
            player = {
                graphics: scene.add.rectangle(250, 445, 40, 50, 0x0088ff),
                x: 250,
                y: 445,
                width: 40,
                height: 50
            };
            player.graphics.setStrokeStyle(3, 0x00ffff);
            
            scene.cursors = scene.input.keyboard.createCursorKeys();
            
            // Initial spawns
            setTimeout(() => spawnEnemy(250, 50), 100);
            setTimeout(() => spawnEnemy(300, 50), 700);
            setTimeout(() => spawnBonus(550, 50), 2000);
            
            console.log("Setup complete!");
        }
        
        function spawnEnemy(x, y) {
            const enemy = {
                graphics: scene.add.rectangle(x, y, 40, 45, 0xff0000),
                hitbox: scene.add.rectangle(x, y, 40, 45, 0xff0000, 0),
                x: x, y: y, width: 40, height: 45,
                speed: 100, chaseSpeed: 80,
                hp: 3, maxHp: 3,
                hpBar: scene.add.rectangle(x, y + 30, 35, 5, 0x00ff00)
            };
            enemy.graphics.setStrokeStyle(3, 0xff6666);
            enemy.hitbox.setStrokeStyle(2, 0xffff00);
            enemies.push(enemy);
        }
        
        function spawnBonus(x, y) {
            let value = 1, text = '+1', color = 0x00ff00;
            if (wave > 20) { value = 10; text = '+10'; color = 0xffff00; }
            else if (wave > 15) { value = 5; text = '+5'; color = 0x00ffff; }
            else if (wave > 10) { value = 3; text = '+3'; color = 0x00ffcc; }
            else if (wave > 5) { value = 2; text = '+2'; color = 0x00ff88; }
            
            const bonus = {
                graphics: scene.add.circle(x, y, 22, color),
                hitbox: scene.add.circle(x, y, 22, color, 0),
                text: scene.add.text(x, y, text, {
                    fontSize: value >= 5 ? '22px' : '18px',
                    fill: '#fff', fontStyle: 'bold',
                    stroke: '#000000', strokeThickness: 3
                }).setOrigin(0.5),
                x: x, y: y, width: 44, height: 44,
                speed: 80, value: value
            };
            bonus.graphics.setStrokeStyle(3, color - 0x003300);
            bonus.hitbox.setStrokeStyle(2, 0xffff00);
            
            scene.tweens.add({
                targets: bonus.graphics,
                scaleX: value >= 5 ? 1.4 : 1.3,
                scaleY: value >= 5 ? 1.4 : 1.3,
                duration: 600, yoyo: true, repeat: -1,
                ease: 'Sine.easeInOut'
            });
            
            bonuses.push(bonus);
        }
        
        function shootBullet() {
            const bullet = {
                graphics: scene.add.rectangle(player.x, player.y - 30, 6, 20, 0xffff00),
                hitbox: scene.add.rectangle(player.x, player.y - 30, 6, 20, 0xffff00, 0),
                x: player.x, y: player.y - 30,
                width: 6, height: 20, speed: -400
            };
            bullet.graphics.setStrokeStyle(2, 0xffaa00);
            bullet.hitbox.setStrokeStyle(2, 0x00ffff);
            bullets.push(bullet);
        }
        
        function checkCollision(obj1, obj2) {
            return obj1.x < obj2.x + obj2.width &&
                   obj1.x + obj1.width > obj2.x &&
                   obj1.y < obj2.y + obj2.height &&
                   obj1.y + obj1.height > obj2.y;
        }
        
        function isInPassage(y) {
            return y >= 420 && y <= 470;
        }
        
        function updateUI() {
            document.getElementById('armyCount').textContent = playerArmy;
            document.getElementById('waveCount').textContent = wave;
            document.getElementById('scoreCount').textContent = score;
        }
        
        function gameOver() {
            gameState = 'over';
            scene.tweens.add({
                targets: player.graphics,
                alpha: 0, angle: 360, duration: 1000
            });
            document.getElementById('ui-overlay').innerHTML = `
                <div style="text-align: center;">
                    <div style="color: #ff0000; font-size: 36px;">GAME OVER!</div>
                    <div style="font-size: 20px; margin-top: 10px;">
                        Score: ${score} | Wave: ${wave}
                    </div>
                    <div style="font-size: 14px; color: #ffff00; margin-top: 10px;">
                        Press F5 to restart
                    </div>
                </div>
            `;
            document.getElementById('ui-overlay').classList.add('game-over');
        }
        
        function update(time, delta) {
            if (gameState !== 'playing') return;
            
            const dt = delta / 1000;
            
            // Stars
            stars.forEach(star => {
                star.graphics.y += star.speed * dt;
                if (star.graphics.y > 650) {
                    star.graphics.y = -50;
                    star.graphics.x = Phaser.Math.Between(0, 800);
                }
            });
            
            // Player movement
            if (scene.cursors.left.isDown) {
                let newX = player.x - 8;
                if (isInPassage(player.y)) {
                    player.x = newX;
                } else {
                    const barrierX = 400 - 7.5;
                    if (!(newX < barrierX + 15 && newX + player.width > barrierX)) {
                        player.x = newX;
                    }
                }
            }
            if (scene.cursors.right.isDown) {
                let newX = player.x + 8;
                if (isInPassage(player.y)) {
                    player.x = newX;
                } else {
                    const barrierX = 400 - 7.5;
                    if (!(newX < barrierX + 15 && newX + player.width > barrierX)) {
                        player.x = newX;
                    }
                }
            }
            player.x = Phaser.Math.Clamp(player.x, 160, 640);
            player.graphics.x = player.x;
            
            // Auto-shoot
            shootTimer += delta;
            if (shootTimer > 250) {
                shootBullet();
                shootTimer = 0;
            }
            
            // Enemies chase player
            enemies.forEach(enemy => {
                const dx = player.x - enemy.x;
                const dy = player.y - enemy.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                
                if (dist > 0) {
                    const dirX = dx / dist;
                    const dirY = dy / dist;
                    const newX = enemy.x + dirX * enemy.chaseSpeed * dt;
                    const newY = enemy.y + dirY * enemy.chaseSpeed * dt;
                    
                    if (isInPassage(enemy.y)) {
                        enemy.x = newX;
                        enemy.y = newY;
                    } else {
                        const barrierX = 400 - 7.5;
                        const hit = newX < barrierX + 15 && newX + enemy.width > barrierX;
                        if (!hit) {
                            enemy.x = newX;
                            enemy.y = newY;
                        } else {
                            enemy.y += enemy.speed * dt;
                            if (Math.abs(enemy.y - 445) < 100) {
                                enemy.x += (enemy.x < 400 ? 30 : -30) * dt;
                            }
                        }
                    }
                }
                
                enemy.graphics.x = enemy.x;
                enemy.graphics.y = enemy.y;
                enemy.hitbox.x = enemy.x;
                enemy.hitbox.y = enemy.y;
                enemy.hpBar.x = enemy.x;
                enemy.hpBar.y = enemy.y + 30;
            });
            
            // Bullets move up
            bullets.forEach(bullet => {
                bullet.y += bullet.speed * dt;
                bullet.graphics.y = bullet.y;
                bullet.hitbox.y = bullet.y;
            });
            
            // Bonuses move down
            bonuses.forEach(bonus => {
                bonus.y += bonus.speed * dt;
                bonus.graphics.y = bonus.y;
                bonus.hitbox.y = bonus.y;
                bonus.text.y = bonus.y;
            });
            
            // Collisions: bullets + enemies
            bullets.forEach((bullet, bIdx) => {
                enemies.forEach((enemy, eIdx) => {
                    if (checkCollision(bullet, enemy)) {
                        bullet.graphics.destroy();
                        bullet.hitbox.destroy();
                        bullets.splice(bIdx, 1);
                        
                        enemy.hp--;
                        const percent = enemy.hp / enemy.maxHp;
                        enemy.hpBar.scaleX = percent;
                        if (percent < 0.5) enemy.hpBar.setFillStyle(0xffaa00);
                        if (percent < 0.25) enemy.hpBar.setFillStyle(0xff0000);
                        
                        scene.tweens.add({
                            targets: enemy.graphics,
                            alpha: 0.3, duration: 50, yoyo: true
                        });
                        
                        if (enemy.hp <= 0) {
                            const explosion = scene.add.circle(enemy.x, enemy.y, 50, 0xffaa00, 0.8);
                            scene.tweens.add({
                                targets: explosion,
                                scale: 2, alpha: 0, duration: 500,
                                onComplete: () => explosion.destroy()
                            });
                            
                            enemy.graphics.destroy();
                            enemy.hitbox.destroy();
                            enemy.hpBar.destroy();
                            enemies.splice(eIdx, 1);
                            score += 25;
                            updateUI();
                        }
                    }
                });
            });
            
            // Collisions: player + enemies
            enemies.forEach((enemy, idx) => {
                if (checkCollision(player, enemy)) {
                    playerArmy--;
                    updateUI();
                    scene.cameras.main.shake(250, 0.02);
                    scene.cameras.main.flash(200, 255, 0, 0);
                    
                    enemy.graphics.destroy();
                    enemy.hitbox.destroy();
                    enemy.hpBar.destroy();
                    enemies.splice(idx, 1);
                    
                    if (playerArmy <= 0) gameOver();
                }
            });
            
            // Collisions: player + bonuses
            bonuses.forEach((bonus, idx) => {
                if (checkCollision(player, bonus)) {
                    playerArmy += bonus.value;
                    score += bonus.value * 15;
                    updateUI();
                    
                    const flash = scene.add.circle(bonus.x, bonus.y, 40 + bonus.value * 5, bonus.graphics.fillColor, 0.7);
                    scene.tweens.add({
                        targets: flash,
                        scale: 2.5, alpha: 0, duration: 400,
                        onComplete: () => flash.destroy()
                    });
                    
                    const floatText = scene.add.text(bonus.x, bonus.y - 30, `+${bonus.value} ARMY!`, {
                        fontSize: bonus.value >= 5 ? '24px' : '18px',
                        fill: bonus.value >= 10 ? '#ffff00' : '#00ff00',
                        fontStyle: 'bold',
                        stroke: '#000000',
                        strokeThickness: 4
                    }).setOrigin(0.5);
                    
                    scene.tweens.add({
                        targets: floatText,
                        y: floatText.y - 50,
                        alpha: 0, duration: 1000,
                        onComplete: () => floatText.destroy()
                    });
                    
                    bonus.graphics.destroy();
                    bonus.hitbox.destroy();
                    bonus.text.destroy();
                    bonuses.splice(idx, 1);
                }
            });
            
            // Cleanup
            enemies = enemies.filter(e => {
                if (e.y > 650) {
                    e.graphics.destroy();
                    e.hitbox.destroy();
                    e.hpBar.destroy();
                    return false;
                }
                return true;
            });
            
            bullets = bullets.filter(b => {
                if (b.y < -50) {
                    b.graphics.destroy();
                    b.hitbox.destroy();
                    return false;
                }
                return true;
            });
            
            bonuses = bonuses.filter(b => {
                if (b.y > 650) {
                    b.graphics.destroy();
                    b.hitbox.destroy();
                    b.text.destroy();
                    return false;
                }
                return true;
            });
            
            // Continuous spawning
            spawnTimer += delta;
            const interval = 5000 - Math.min(wave * 100, 2000);
            
            if (spawnTimer > interval) {
                let enemyCount = wave <= 3 ? 2 : wave <= 6 ? 3 : wave <= 10 ? 4 : wave <= 15 ? 5 : 6;
                
                for (let i = 0; i < enemyCount; i++) {
                    setTimeout(() => {
                        spawnEnemy(Phaser.Math.Between(170, 370), 50);
                    }, i * 700);
                }
                
                const bonusChance = Math.min(0.2 + wave * 0.02, 0.4);
                if (Math.random() < bonusChance) {
                    setTimeout(() => {
                        spawnBonus(Phaser.Math.Between(430, 630), 50);
                    }, 1200);
                }
                
                wave++;
                updateUI();
                spawnTimer = 0;
            }
        }
        
        console.log("Game ready! Use left/right arrows to move");
    </script>
</body>
</html>